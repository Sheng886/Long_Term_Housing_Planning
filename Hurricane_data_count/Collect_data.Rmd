---
title: "Regression"
output: html_document
date: "2022-09-22"
---

## Package

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(zoo)
library(dplyr)
library(ggplot2) 
library(maps)
library(sp)
library(maptools)
```

```{r}
Hurricane_ = read.csv("Hurricane_track/Hurricane_landfall_windspeed.csv", as.is=T)


year <- sub(".*/.*/", "", Hurricane_$year)
year = substr(year, 1, 4)
Hurricane_$year = year

Hurricane_$Latitude = as.numeric(substr(Hurricane_$Latitude, 1, 4))
Hurricane_$Longitude = as.numeric(substr(Hurricane_$Longitude, 1, 4))

Hurricane_$Latitude = Hurricane_$Latitude
Hurricane_$Longitude = Hurricane_$Longitude*-1

Hurricane_data_Gulf = Hurricane_[Hurricane_$Longitude < -81.4,]
Hurricane_data_Atlantic = Hurricane_[Hurricane_$Longitude >= -81.4 & Hurricane_$Longitude <= -70,]


# Create a base map of the USA
usa_map <- map_data("usa")

# Plot the map with the coordinates
ggplot() +
  geom_polygon(data = usa_map, aes(x = long, y = lat, group = group), fill = "lightgray", color = "black") +
  geom_point(data = Hurricane_data_Gulf, aes(x = Longitude, y = Latitude), color = "purple", size = 1) +
  geom_point(data = Hurricane_data_Atlantic, aes(x = Longitude, y = Latitude), color = "orange", size = 1) +
  coord_fixed(1.3) +  # Fix aspect ratio
  labs(title = "Landfall", x = "Longitude", y = "Latitude") +
  theme_minimal()

```
```{r}
lonlat_to_state_sp <- function(pointsDF) {
    # Prepare SpatialPolygons object with one SpatialPolygon
    states <- map('state', fill=TRUE, col="transparent", plot=FALSE)
    IDs <- sapply(strsplit(states$names, ":"), function(x) x[1])
    states_sp <- map2SpatialPolygons(states, IDs=IDs, proj4string=CRS("+proj=longlat +datum=WGS84"))

    # Convert pointsDF to a SpatialPoints object 
    pointsSP <- SpatialPoints(pointsDF, proj4string=CRS("+proj=longlat +datum=WGS84"))

    # Use 'over' to get _indices_ of the Polygons object containing each point 
        indices <- over(pointsSP, states_sp)

    # Return the state names of the Polygons object containing each point
    stateNames <- sapply(states_sp@polygons, function(x) x@ID)
    stateNames[indices]
}

# Test the function using points in Wisconsin and Oregon.
landfall_Gulf <- data.frame(x = Hurricane_data_Gulf$Longitude, y = Hurricane_data_Gulf$Latitude)
landfall_Atlantic <- data.frame(x = Hurricane_data_Atlantic$Longitude, y = Hurricane_data_Atlantic$Latitude)

lonlat_to_state_sp(landfall_Atlantic)
```


